pipeline {
    agent { label'jenkins-agent' }
    tools {
        jdk 'Java17'
        maven 'Maven3'
}
environment {
        APP_NAME = "register-app-pipeline"
        RELEASE = "1.0.0"
        DOCKER_USER = "himanis03"
        DOCKER_PASS = 'dockerhub' #dockerhub credential in jenkins
        IMAGE_NAME = "${DOCKER_USER}" + "/" + "${APP_NAME}
        IMAGE_TAG = ${RELEASE}-${BUILD_NUMBER}"

stages {
    stage("cleanup workspace"){
          steps {
          cleanWs()
          }
}
  stage("checkout from scm"){
          steps {
              git branch: 'main', credentialsId: 'github', url: 'https://github.com/himani0323/registration-app.git'
          }
  }
  stage("build app"){
      steps {
        sh "mvn clean package"
      }
  }
   stage("test"){
       steps {
            sh "mvn test"
      }
  }
  
   stage("build & push docker image"){
       steps {
          script {
              docker.withResistry('',DOCKER_PASS) {
              docker_image = docker.build "${IMAGE_NAME}"
}
        
          docker.withResistry('',DOCKER_PASS) {
              docker_image.push('${IMAGE_TAG}")
              docker_image.push('latest')

  
    }
 } 
}
}
      

          
 
   
 
